@inherits Umbraco.Web.Mvc.UmbracoTemplatePage

@* builds the "straight to" and "More" links on landing pages *@

@{
    int mainCount;

    string mainName = umbraco.library.GetDictionaryItem("MainSection");
    string moreName = umbraco.library.GetDictionaryItem("MoreSection");
	string ignoreType = "SectionHomepage";

    @* overrides - can be passed in the viewdata *@
    if (!int.TryParse(ViewData["mainCount"].ToString(), out mainCount)) { mainCount = 6; }

    if (ViewData["mainName"] != null) 
    {        
        mainName = ViewData["mainName"].ToString();
    }
    
    if (ViewData["moreName"] != null)
    {
        moreName = ViewData["moreName"].ToString();
    }

	if (ViewData["ignoreType"] != null)
    {
        ignoreType = ViewData["ignoreType"].ToString();
    }
    
    var nodes = Model.Content.Children.Where(x => x.IsVisible() && x.DocumentTypeAlias != ignoreType); 
}

@if ( nodes.Any() )
{

	if ( !string.IsNullOrEmpty(mainName))
	{   
    	<div class="row">
        	<div class="col-xs-12">
            	<h2>@mainName</h2>
        	</div>
    	</div>
	}

	<div class="row">	
    	@foreach(var node in nodes.Take(mainCount))
    	{
        	<div class="col-lg-4 col-md-6">
            	<div class="landing-item">
                	<a class="landing-link" href="@node.Url">
                    	<div class="landing-title">
                        	<h3>@node.GetPropertyValue("title")</h3>
                    	</div>
                    	<div class="landing-text">
                        	@node.GetPropertyValue("landingSummary")
                    	</div>
                	</a>
            	</div>
        	</div>
    	}
	</div>

	@* if there are more child nodes than the main count - we have a 'more' list *@
	if (nodes.Count() > mainCount)
	{
    	if ( !string.IsNullOrEmpty(moreName))
    	{ 
        	<div class="row landing-more">
            	<div class="col-xs-12">
                	<h2>@moreName</h2>
            	</div>
        	</div>
    	}
    
	    <div class="row">
	        <div class="col-xs-12">
    	        <ul class="nav nav-pills landing-more">
        	        @foreach(var node in nodes.Skip(mainCount))
            	    {
                	    <li><a href="@node.Url">@node.GetPropertyValue("title")</a></li>
                	}
            	</ul>
        	</div>
    	</div>
	}
}
